import json
import re
import os

# --- ğŸ¯ æ›¿æ¢æ¸…å• (ID : æ–°è¯) ---
REPLACEMENTS = {
    # === ç¬¬ä¸€æ‰¹ä¿®å¤ (ç”Ÿæ´»ç±»é‡å¤/é•¿è¯) ===
    20628: "è½¬å‘",
    20567: "æµ‹è°ä»ª",
    20634: "ä¸¾æŠ¥",
    20318: "åº¦èœœæœˆ",
    20534: "ç¼–è¾«å­",
    20542: "è¸®è„šå°–",
    20528: "ä¸¢æ‰‹ç»¢",
    20603: "æ´—ç¢—æœº",
    20604: "é™¤æ¹¿æœº",
    20605: "æ”¶éŸ³æœº",
    20778: "æ‰“å­”æœº",
    20765: "å›¾é’‰",
    20617: "ç½‘çº¿",
    20726: "å‡é€Ÿå¸¦",
    20480: "æ¢ä¹˜",

    # === ç¬¬äºŒæ‰¹ä¿®å¤ (æ˜¥èŠ‚ç±»é‡å¤) ===
    20925: "æ¼±å£",
    21028: "æ³¡æ¾¡",
    20938: "æ‰“å“ˆæ¬ ",
    21089: "å‰¥å¼€å¿ƒæœ",
    21099: "æ•¬é…’",
    21179: "æ™•è½¦",
    20905: "åˆ·è„¸æ”¯ä»˜",
    21200: "æ‘¸ç‰Œ",
    21201: "å‡ºç‰Œ",
    21221: "ç»ƒæ­Œ",
    21217: "ä¹°ç¥¨",
    21228: "æŠ•å¸",
    21229: "æµ·ç›—èˆ¹",
    20823: "æ”¶çº¿",
    21239: "åšé£ç­",
    21235: "æ»šé›ªçƒ",
    21236: "æ»‘å†°",
    21233: "è’¸æ¡‘æ‹¿",
    20888: "æ¨æ‹¿",
    21180: "æ’é˜Ÿ",
    21199: "æ¡æ‰‹",
    21166: "æˆ´è€³å¡",
    21216: "ç‚¹å…³æ³¨",
    20911: "å‘çº¢åŒ…",
    21012: "æ‹†çº¢åŒ…",
    21322: "é›†èµ",
    21188: "æ•°æ®çº¿",
    21248: "è§å®¶é•¿",
    21003: "å†™å¯¹è”",
    21006: "ç‚¹é­ç‚®",
    21001: "é€ç¤¼",
    20886: "æŸ“å‘",
    21027: "çƒ«å‘",
    20884: "æ‰“åŒ…",
    20885: "æ´—èœ",
    21093: "å•ƒéª¨å¤´",
    21087: "çƒ¤ç‰ç±³",
    20928: "æŠ¹æŠ¤æ‰‹éœœ",
    20924: "æ´—è„š",
    20940: "æ“¦é¼»æ¶•",
    20825: "è·³æˆ¿å­",
    21234: "æ»‘è‰",
    21246: "è‡ªæ‹",
    20992: "å¹æ°”çƒ",
    21007: "ç‚¹çƒŸèŠ±",
    21231: "æ¼‚æµ",
    21232: "å¾’æ­¥",
    20993: "å’¬ç¬”å¤´",
    21164: "ç«æŸ´",
    20831: "æŠ˜çº¸",
    21344: "åˆ»çº¸",
    20829: "æœ¨å¶æˆ",
    21345: "äº¬å‰§",
    21034: "èˆéº’éºŸ",
    20828: "è¸©é«˜è··",
    21035: "åˆ’æ—±èˆ¹",
    21033: "å¯¹å¯¹è”",
    20832: "è®¸æ„¿",
    21043: "è¿˜æ„¿",
    20998: "æ‘Šæ‰‹",
    20617: "å…‰çŒ«",
    20962: "å è¢«å­",
    20949: "ä¸‹æ°´é“",
    20948: "è·¯ç¯",
    21329: "æ–—å›¾",
    21319: "è¯­éŸ³èŠå¤©",
    21326: "æ‰«ä¸€æ‰«",
    21054: "å’Œé¢",
    20982: "æ–­ç”µ",
    21371: "çº¢æ³¥",
    20806: "é¾™è™¾",
    21220: "å¯ä¹",
    21005: "ç‚¹ç¯ç¬¼",
    21225: "å°„å‡»",
    21342: "å¹ç³–äºº",
    21041: "æ‹œä½›",
    21011: "å¡çº¢åŒ…",
    21247: "å¤§åˆå½±",
    21391: "ç…®æ±¤åœ†",
    21388: "èµèŠ±ç¯",
    21185: "æ‰‹ä¿¡"
}

def apply_fixes(file_path):
    print(f"ğŸ”§ æ­£åœ¨ä¿®å¤æ–‡ä»¶: {file_path} ...")

    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
    except FileNotFoundError:
        print("âŒ æ‰¾ä¸åˆ°æ–‡ä»¶ï¼")
        return

    # 1. æ¸…æ´— (ä¿ç•™ä¹‹å‰çš„é€»è¾‘)
    content = re.sub(r'export default\s*', '', content)
    content = re.sub(r'//.*', '', content)
    content = content.strip().rstrip(';')
    content = re.sub(r',\s*]', ']', content)

    try:
        data = json.loads(content)
    except json.JSONDecodeError as e:
        print(f"âŒ JSON è§£æå¤±è´¥: {e}")
        return

    # 2. æ‘Šå¹³æ•°æ®
    flat_data = []
    def flatten(item):
        if isinstance(item, list):
            for sub in item:
                flatten(sub)
        elif isinstance(item, dict):
            flat_data.append(item)
    
    if isinstance(data, list):
        flatten(data)
    else:
        print("âŒ æ•°æ®æ ¼å¼é”™è¯¯")
        return

    # 3. æ‰§è¡Œæ›¿æ¢
    count = 0
    id_fix_count = 0
    
    for item in flat_data:
        wid = item.get('word_id')
        word = item.get('word')

        # --- å¸¸è§„å¤„ç†: æ›¿æ¢è¯æ±‡ ---
        if wid in REPLACEMENTS:
            new_word = REPLACEMENTS[wid]
            if word != new_word:
                item['word'] = new_word
                print(f"  âœ… ID {wid}: '{word}' -> '{new_word}'")
                count += 1

    print("-" * 30)
    print(f"ğŸ‰ ä¿®å¤å®Œæˆï¼\n  - ä¿®æ”¹è¯æ±‡: {count} ä¸ª\n  - è§£å†³å†²çª: {id_fix_count} ä¸ª")

    # 4. ä¿å­˜
    new_content = "export default " + json.dumps(flat_data, ensure_ascii=False, indent=4)
    with open(file_path, 'w', encoding='utf-8') as f:
        f.write(new_content)
        
    print(f"ğŸ’¾ æ–‡ä»¶å·²ä¿å­˜: {file_path}")

if __name__ == "__main__":
    # è¯·ç¡®ä¿è¿™é‡Œæ˜¯ä½ æœ€æ–°çš„æ•°æ®æ–‡ä»¶ (å»ºè®® life_fixed.js)
    apply_fixes("life_fixed.js")